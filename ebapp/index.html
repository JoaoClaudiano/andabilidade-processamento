<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andabilidade Brasil | Caminhabilidade Urbana</title>
    
    <!-- Bibliotecas de Mapa -->
    <script src="https://unpkg.com"></script>
    <link href="https://unpkg.com" rel="stylesheet" />
    <script src="https://unpkg.com"></script>

    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .search-container {
            position: absolute; top: 20px; left: 20px; z-index: 1;
            background: white; padding: 10px; border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2); width: 300px;
        }
        input { width: 80%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 8px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        .legend {
            position: absolute; bottom: 30px; right: 20px; background: white;
            padding: 10px; border-radius: 8px; font-size: 12px; line-height: 1.5;
        }
    </style>
</head>
<body>

<div class="search-container">
    <input type="text" id="address" placeholder="Digite uma cidade ou rua...">
    <button onclick="searchAddress()">üîç</button>
</div>

<div id="map"></div>

<div class="legend">
    <strong>Walk Score (Caminhabilidade)</strong><br>
    <div style="background: #d73027; width: 15px; height: 15px; display: inline-block;"></div> 0-24 (Carro dependente)<br>
    <div style="background: #fee08b; width: 15px; height: 15px; display: inline-block;"></div> 50-69 (Razo√°vel)<br>
    <div style="background: #1a9850; width: 15px; height: 15px; display: inline-block;"></div> 90-100 (Para√≠so)
</div>

<script>
    // Inicializar o plugin PMTiles
    let protocol = new pmtiles.Protocol();
    maplibregl.addProtocol("pmtiles", protocol.tile);

    // URL do arquivo de dados que voc√™ subir√° no Cloudflare
    // Por enquanto, usaremos uma URL tempor√°ria ou local
    const PMTILES_URL = "https://seu-site.pages.dev";

    const map = new maplibregl.Map({
        container: 'map',
        style: 'https://demotiles.maplibre.org', // Estilo base (ruas)
        center: [-46.6333, -23.5505], // S√£o Paulo
        zoom: 12
    });

    map.on('load', () => {
        // Adicionar a fonte de dados PMTiles (os scores calculados)
        map.addSource('walkscore_source', {
            type: 'vector',
            url: `pmtiles://${PMTILES_URL}`
        });

        // Adicionar a camada visual (Heatmap ou Pontos coloridos)
        map.addLayer({
            'id': 'walkscore_layer',
            'type': 'circle', // ou 'fill' se usar hex√°gonos
            'source': 'walkscore_source',
            'source-layer': 'nodes', // nome da camada dentro do pmtiles
            'paint': {
                'circle-radius': 5,
                'circle-color': [
                    'interpolate', ['linear'], ['get', 'walk_score'],
                    0, '#d73027',
                    50, '#fee08b',
                    100, '#1a9850'
                ],
                'circle-opacity': 0.7
            }
        });
    });

    // Fun√ß√£o de busca simples via Nominatim (OpenStreetMap)
    async function searchAddress() {
        const query = document.getElementById('address').value;
        const response = await fetch(`https://nominatim.openstreetmap.org{query}`);
        const data = await response.json();
        if (data.length > 0) {
            map.flyTo({ center: [data[0].lon, data[0].lat], zoom: 15 });
        }
    }
</script>

</body>
</html>
